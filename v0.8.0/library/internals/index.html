<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Private · OceanTurbulenceParameterEstimation.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://clima.github.io/OceanTurbulenceParameterEstimation/dev/library/internals/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><script src="../../../copy.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">OceanTurbulenceParameterEstimation.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../installation_instructions/">Installation Instructions</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../literated/intro_to_observations/">Intro to observations</a></li><li><a class="tocitem" href="../../literated/intro_to_inverse_problems/">Intro to <code>InverseProblem</code></a></li><li><a class="tocitem" href="../../literated/exploring_priors/">Specifying and fine-tuning prior distributions</a></li><li><a class="tocitem" href="../../literated/perfect_convective_adjustment_calibration/">Perfect convective adjustment calibration with Ensemble Kalman Inversion</a></li><li><a class="tocitem" href="../../literated/perfect_catke_calibration/">Perfect CAKTE calibration with Ensemble Kalman Inversion</a></li><li><a class="tocitem" href="../../literated/lesbrary_catke_calibration/">CAKTE calibration with Ensemble Kalman Inversion using LESbrary data</a></li><li><a class="tocitem" href="../../literated/perfect_baroclinic_adjustment_calibration/">Perfect baroclinic adjustment calibration with Ensemble Kalman Inversion</a></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../outline/">Contents</a></li><li><a class="tocitem" href="../public/">Public</a></li><li class="is-active"><a class="tocitem" href>Private</a><ul class="internal"><li><a class="tocitem" href="#OceanTurbulenceParameterEstimation"><span>OceanTurbulenceParameterEstimation</span></a></li><li><a class="tocitem" href="#Observations"><span>Observations</span></a></li><li><a class="tocitem" href="#Parameters"><span>Parameters</span></a></li><li><a class="tocitem" href="#EnsembleKalmanInversions"><span>EnsembleKalmanInversions</span></a></li></ul></li><li><a class="tocitem" href="../function_index/">Function index</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Library</a></li><li class="is-active"><a href>Private</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Private</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/OceanTurbulenceParameterEstimation.jl/blob/master/docs/src/library/internals.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Private-types-and-functions"><a class="docs-heading-anchor" href="#Private-types-and-functions">Private types and functions</a><a id="Private-types-and-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Private-types-and-functions" title="Permalink"></a></h1><p>Documentation for <code>OceanTurbulenceParameterEstimation.jl</code>&#39;s internal interface.</p><h2 id="OceanTurbulenceParameterEstimation"><a class="docs-heading-anchor" href="#OceanTurbulenceParameterEstimation">OceanTurbulenceParameterEstimation</a><a id="OceanTurbulenceParameterEstimation-1"></a><a class="docs-heading-anchor-permalink" href="#OceanTurbulenceParameterEstimation" title="Permalink"></a></h2><h2 id="Observations"><a class="docs-heading-anchor" href="#Observations">Observations</a><a id="Observations-1"></a><a class="docs-heading-anchor-permalink" href="#Observations" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="OceanTurbulenceParameterEstimation.Observations.FieldTimeSeriesCollector-Tuple{Any, Any}" href="#OceanTurbulenceParameterEstimation.Observations.FieldTimeSeriesCollector-Tuple{Any, Any}"><code>OceanTurbulenceParameterEstimation.Observations.FieldTimeSeriesCollector</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">FieldTimeSeriesCollector(collected_fields, times; architecture=CPU())</code></pre><p>Returns a <code>FieldTimeSeriesCollector</code> for <code>fields</code> of <code>simulation</code>. <code>fields</code> is a <code>NamedTuple</code> of <code>AbstractField</code>s that are to be collected.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/OceanTurbulenceParameterEstimation.jl/blob/c6b7a7e47f0deaf3e3ed854ecb2665102c08ff67/src/Observations.jl#L274-L279">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="OceanTurbulenceParameterEstimation.Observations.SyntheticObservations" href="#OceanTurbulenceParameterEstimation.Observations.SyntheticObservations"><code>OceanTurbulenceParameterEstimation.Observations.SyntheticObservations</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">SyntheticObservations(path; field_names,
                      transformation = Transformation()),
                      times = nothing,
                      field_time_serieses = nothing,
                      regrid_size = nothing)</code></pre><p>Return a time series of synthetic observations generated by Oceananigans.jl&#39;s simulations gridded as Oceananigans.jl fields.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/OceanTurbulenceParameterEstimation.jl/blob/c6b7a7e47f0deaf3e3ed854ecb2665102c08ff67/src/Observations.jl#L31-L40">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="OceanTurbulenceParameterEstimation.Observations.column_ensemble_interior-Tuple{Vector{var&quot;#s80&quot;} where var&quot;#s80&quot;&lt;:SyntheticObservations, Any, Any, Any}" href="#OceanTurbulenceParameterEstimation.Observations.column_ensemble_interior-Tuple{Vector{var&quot;#s80&quot;} where var&quot;#s80&quot;&lt;:SyntheticObservations, Any, Any, Any}"><code>OceanTurbulenceParameterEstimation.Observations.column_ensemble_interior</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">column_ensemble_interior(observations::Vector{&lt;:SyntheticObservations}, field_name, time_indices::Vector, N_ens)</code></pre><p>Returns an <code>Nensemble × Nbatch × Nz</code> Array of <code>(1, 1, Nz)</code> <code>field_name</code> data, given <code>Nbatch</code> <code>SyntheticObservations</code> objects. The <code>Nbatch × Nz</code> data for <code>field_name</code> is copied <code>Nensemble</code> times to form a 3D Array.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/OceanTurbulenceParameterEstimation.jl/blob/c6b7a7e47f0deaf3e3ed854ecb2665102c08ff67/src/Observations.jl#L195-L201">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="OceanTurbulenceParameterEstimation.Observations.observation_names-Tuple{Vector{var&quot;#s82&quot;} where var&quot;#s82&quot;&lt;:SyntheticObservations}" href="#OceanTurbulenceParameterEstimation.Observations.observation_names-Tuple{Vector{var&quot;#s82&quot;} where var&quot;#s82&quot;&lt;:SyntheticObservations}"><code>OceanTurbulenceParameterEstimation.Observations.observation_names</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">observation_names(obs::Vector{&lt;:SyntheticObservations})</code></pre><p>Return a Set representing the union of all names in <code>obs</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/OceanTurbulenceParameterEstimation.jl/blob/c6b7a7e47f0deaf3e3ed854ecb2665102c08ff67/src/Observations.jl#L110-L114">source</a></section></article><h2 id="Parameters"><a class="docs-heading-anchor" href="#Parameters">Parameters</a><a id="Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Parameters" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="OceanTurbulenceParameterEstimation.Parameters.FreeParameters-Tuple{Any}" href="#OceanTurbulenceParameterEstimation.Parameters.FreeParameters-Tuple{Any}"><code>OceanTurbulenceParameterEstimation.Parameters.FreeParameters</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">FreeParameters(priors; names = Symbol.(keys(priors)))</code></pre><p>Return named <code>FreeParameters</code> with priors. Free parameter <code>names</code> are inferred from the keys of <code>priors</code> if not provided.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; using Distributions, OceanTurbulenceParameterEstimation

julia&gt; priors = (ν = Normal(1e-4, 1e-5), κ = Normal(1e-3, 1e-5))
(ν = Normal{Float64}(μ=0.0001, σ=1.0e-5), κ = Normal{Float64}(μ=0.001, σ=1.0e-5))

julia&gt; free_parameters = FreeParameters(priors)
FreeParameters with 2 parameters
├── names: (:ν, :κ)
└── priors: Dict{Symbol, Any}
    ├── ν =&gt; Normal{Float64}(μ=0.0001, σ=1.0e-5)
    └── κ =&gt; Normal{Float64}(μ=0.001, σ=1.0e-5)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/OceanTurbulenceParameterEstimation.jl/blob/c6b7a7e47f0deaf3e3ed854ecb2665102c08ff67/src/Parameters.jl#L261-L283">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="OceanTurbulenceParameterEstimation.Parameters.ScaledLogitNormal" href="#OceanTurbulenceParameterEstimation.Parameters.ScaledLogitNormal"><code>OceanTurbulenceParameterEstimation.Parameters.ScaledLogitNormal</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ScaledLogitNormal([FT=Float64;] bounds=(0, 1), mass=0.5, interval=nothing)</code></pre><p>Return a <code>ScaledLogitNormal</code> distribution with compact support within <code>bounds</code>.</p><p><code>interval</code> is an optional 2-element tuple or Array. When specified, the parameters <code>μ</code> and <code>σ</code> of the underlying <code>Normal</code> distribution are calculated so that <code>mass</code> fraction of the probability density lies within <code>interval</code>.</p><p>If <code>interval</code> is not specified, then <code>μ=0</code> and <code>σ=1</code> by default.</p><p><strong>Notes</strong></p><p><code>ScaledLogitNormal</code> is a four-parameter distribution generated by the transformation</p><p class="math-container">\[Y = L + (U - L) / [1 + \exp(X)],\]</p><p>of the normally-distributed variate <span>$X ∼ 𝒩(μ, σ)$</span>. The four parameters governing the distribution of <span>$Y$</span> are thus</p><ul><li><span>$L$</span>:  lower bound (0 for the <code>LogitNormal</code> distribution)</li><li><span>$U$</span>:  upper bound (1 for the <code>LogitNormal</code> distribution)</li><li><span>$μ$</span>:  mean of the underlying <code>Normal</code> distribution</li><li><span>$σ²$</span>: variance of the underlying <code>Normal</code> distribution</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/OceanTurbulenceParameterEstimation.jl/blob/c6b7a7e47f0deaf3e3ed854ecb2665102c08ff67/src/Parameters.jl#L97-L126">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="OceanTurbulenceParameterEstimation.Parameters.closure_with_parameters-Tuple{Any, Any}" href="#OceanTurbulenceParameterEstimation.Parameters.closure_with_parameters-Tuple{Any, Any}"><code>OceanTurbulenceParameterEstimation.Parameters.closure_with_parameters</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">closure_with_parameters(closure, parameters)</code></pre><p>Returns a new object where for each (<code>parameter_name</code>, <code>parameter_value</code>) pair  in <code>parameters</code>, the value corresponding to the key in <code>object</code> that matches <code>parameter_name</code> is replaced with <code>parameter_value</code>.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; using OceanTurbulenceParameterEstimation.Parameters: closure_with_parameters

julia&gt; struct ClosureSubModel; a; b end

julia&gt; struct Closure; test; c end

julia&gt; closure = Closure(ClosureSubModel(1, 2), 3)
Closure(ClosureSubModel(1, 2), 3)

julia&gt; parameters = (a = 12, d = 7)
(a = 12, d = 7)

julia&gt; closure_with_parameters(closure, parameters)
Closure(ClosureSubModel(12, 2), 3)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/OceanTurbulenceParameterEstimation.jl/blob/c6b7a7e47f0deaf3e3ed854ecb2665102c08ff67/src/Parameters.jl#L338-L364">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="OceanTurbulenceParameterEstimation.Parameters.lognormal-Tuple{}" href="#OceanTurbulenceParameterEstimation.Parameters.lognormal-Tuple{}"><code>OceanTurbulenceParameterEstimation.Parameters.lognormal</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">lognormal(; mean, std)</code></pre><p>Return <code>Lognormal</code> distribution parameterized by  the distribution <code>mean</code> and standard deviation <code>std</code>.</p><p><strong>Notes</strong></p><p>A variate <code>X</code> is <code>LogNormal</code> distributed if</p><p class="math-container">\[\log(X) ∼ 𝒩(μ, σ²) ,\]</p><p>where <span>$𝒩(μ, σ²)$</span> is the <code>Normal</code> distribution with mean <span>$μ$</span> and variance <span>$σ²$</span>.</p><p>The <code>mean</code> and variance <span>$s²$</span> (where <span>$s$</span> is the standard deviation or <code>std</code>) are related to the parameters <span>$μ$</span> and <span>$σ²$</span> via</p><p class="math-container">\[ m = \exp(μ + σ² / 2),\]</p><p class="math-container">\[s² = [\exp(σ²) - 1] m².\]</p><p>These formula allow us to calculate <span>$μ$</span> and <span>$σ$</span> given <span>$m$</span> and <span>$s²$</span>, since rearranging the formula for <span>$s²$</span> gives</p><p class="math-container">\[\exp(σ²) = m² / s² + 1\]</p><p>which then yields</p><p class="math-container">\[σ = \sqrt{\log(m² / s² + 1)}.\]</p><p>We then find that</p><p class="math-container">\[μ = \log(m) - σ² / 2 .\]</p><p>See also <a href="https://en.wikipedia.org/wiki/Log-normal_distribution#Generation_and_parameters">wikipedia</a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/OceanTurbulenceParameterEstimation.jl/blob/c6b7a7e47f0deaf3e3ed854ecb2665102c08ff67/src/Parameters.jl#L18-L69">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="OceanTurbulenceParameterEstimation.Parameters.normal_to_scaled_logit_normal-Tuple{Any, Any, Any}" href="#OceanTurbulenceParameterEstimation.Parameters.normal_to_scaled_logit_normal-Tuple{Any, Any, Any}"><code>OceanTurbulenceParameterEstimation.Parameters.normal_to_scaled_logit_normal</code></a> — <span class="docstring-category">Method</span></header><section><div><p>Return a logit-normally distributed variate given the normally-distributed variate <code>X</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/OceanTurbulenceParameterEstimation.jl/blob/c6b7a7e47f0deaf3e3ed854ecb2665102c08ff67/src/Parameters.jl#L86">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="OceanTurbulenceParameterEstimation.Parameters.scaled_logit_normal_to_normal-Tuple{Any, Any, Any}" href="#OceanTurbulenceParameterEstimation.Parameters.scaled_logit_normal_to_normal-Tuple{Any, Any, Any}"><code>OceanTurbulenceParameterEstimation.Parameters.scaled_logit_normal_to_normal</code></a> — <span class="docstring-category">Method</span></header><section><div><p>Return a normally-distributed variate given the logit-normally distributed variate <code>Y</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/OceanTurbulenceParameterEstimation.jl/blob/c6b7a7e47f0deaf3e3ed854ecb2665102c08ff67/src/Parameters.jl#L89">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="OceanTurbulenceParameterEstimation.Parameters.transform_to_constrained-Tuple{Normal, Any}" href="#OceanTurbulenceParameterEstimation.Parameters.transform_to_constrained-Tuple{Normal, Any}"><code>OceanTurbulenceParameterEstimation.Parameters.transform_to_constrained</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">transform_to_constrained(Π, X)</code></pre><p>Transform an &quot;unconstrained&quot;, normally-distributed variate <code>X</code> to &quot;constrained&quot; (physical) space via the map associated with the distribution <code>Π</code> of <code>Y</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/OceanTurbulenceParameterEstimation.jl/blob/c6b7a7e47f0deaf3e3ed854ecb2665102c08ff67/src/Parameters.jl#L220-L226">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="OceanTurbulenceParameterEstimation.Parameters.transform_to_unconstrained-Tuple{Normal, Any}" href="#OceanTurbulenceParameterEstimation.Parameters.transform_to_unconstrained-Tuple{Normal, Any}"><code>OceanTurbulenceParameterEstimation.Parameters.transform_to_unconstrained</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">transform_to_unconstrained(Π, Y)</code></pre><p>Transform the &quot;constrained&quot; (physical) variate <code>Y</code> into it&#39;s unconstrained (normally-distributed) counterpart <code>X</code> through the forward map associated with <code>Π</code>.</p><p>If some mapping between <span>$Y$</span> and the normally-distributed <span>$X$</span> is defined via</p><p class="math-container">\[Y = g(X).\]</p><p>Then <code>transform_to_unconstrained</code> is the inverse <span>$X = g^{-1}(Y)$</span>. The change of variables <span>$g(X)$</span> determines the distribution <code>Π</code> of <code>Y</code>.</p><p><strong>Example</strong></p><p>The logarithm of a <code>LogNormal(μ, σ)</code> distributed variate is normally-distributed, such that the forward trasform <span>$f ≡ \exp$</span>,</p><p class="math-container">\[Y = \exp(X),\]</p><p>and the inverse trasnform is the natural logarithm <span>$f^{-1} ≡ \log$</span>,</p><p class="math-container">\[\log(Y) = X ∼ 𝒩(μ, σ).\]</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/OceanTurbulenceParameterEstimation.jl/blob/c6b7a7e47f0deaf3e3ed854ecb2665102c08ff67/src/Parameters.jl#L181-L213">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="OceanTurbulenceParameterEstimation.Parameters.update_closure_ensemble_member!-Tuple{Any, Any, Any}" href="#OceanTurbulenceParameterEstimation.Parameters.update_closure_ensemble_member!-Tuple{Any, Any, Any}"><code>OceanTurbulenceParameterEstimation.Parameters.update_closure_ensemble_member!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">update_closure_ensemble_member!(closures, p_ensemble, parameters)</code></pre><p>Use <code>parameters</code> to update closure from <code>closures</code> that corresponds to ensemble member <code>p_ensemble</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/OceanTurbulenceParameterEstimation.jl/blob/c6b7a7e47f0deaf3e3ed854ecb2665102c08ff67/src/Parameters.jl#L376-L380">source</a></section></article><h2 id="EnsembleKalmanInversions"><a class="docs-heading-anchor" href="#EnsembleKalmanInversions">EnsembleKalmanInversions</a><a id="EnsembleKalmanInversions-1"></a><a class="docs-heading-anchor-permalink" href="#EnsembleKalmanInversions" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="OceanTurbulenceParameterEstimation.EnsembleKalmanInversions.EnsembleKalmanInversion-Tuple{Any}" href="#OceanTurbulenceParameterEstimation.EnsembleKalmanInversions.EnsembleKalmanInversion-Tuple{Any}"><code>OceanTurbulenceParameterEstimation.EnsembleKalmanInversions.EnsembleKalmanInversion</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">EnsembleKalmanInversion(inverse_problem; noise_covariance=1e-2, resampler=Resampler())</code></pre><p>Return an object that interfaces with <a href="https://github.com/CliMA/EnsembleKalmanProcesses.jl">EnsembleKalmanProcesses.jl</a> and uses Ensemble Kalman Inversion to iteratively &quot;solve&quot; the inverse problem:</p><p class="math-container">\[y = G(θ) + η,\]</p><p>for the parameters <span>$θ$</span>, where <span>$y$</span> is a &quot;normalized&quot; vector of observations, <span>$G(θ)$</span> is a forward map that predicts the observations, and <span>$η ∼ 𝒩(0, Γ_y)$</span> is zero-mean random noise with covariance matrix <span>$Γ_y$</span> representing uncertainty in the observations.</p><p>By &quot;solve&quot;, we mean that the iteration finds the parameter values <span>$θ$</span> that minimizes the distance between <span>$y$</span> and <span>$G(θ)$</span>.</p><p>The &quot;forward map output&quot; <code>G</code> can have many interpretations. The specific statistics that <code>G</code> computes have to be selected for each use case to provide a concise summary of the complex model solution that contains the values that we would most like to match to the corresponding truth values <code>y</code>. For example, in the context of an ocean-surface boundary layer parametrization, this summary could be a vector of  concatenated <code>u</code>, <code>v</code>, <code>b</code>, <code>e</code> profiles at all or some time steps of the CATKE solution.</p><p>(For more details on the Ensemble Kalman Inversion algorithm refer to the <a href="https://clima.github.io/EnsembleKalmanProcesses.jl/stable/ensemble_kalman_inversion/">EnsembleKalmanProcesses.jl Documentation</a>.)</p><p><strong>Arguments</strong></p><ul><li><p><code>inverse_problem :: InverseProblem</code>: Represents an inverse problem representing the comparison between                                      synthetic observations generated by                                      <a href="https://clima.github.io/OceananigansDocumentation/stable/">Oceananigans.jl</a>                                      and model predictions, also generated by Oceananigans.jl.</p></li><li><p><code>noise_covariance</code> (<code>AbstractMatrix</code> or <code>Number</code>): normalized covariance representing observational                                                    uncertainty. If <code>noise_covariance isa Number</code> then                                                    it&#39;s converted to an identity matrix scaled by                                                    <code>noise_covariance</code>.</p></li><li><p><code>resampler</code>: controls particle resampling procedure. See <code>Resampler</code>.</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/OceanTurbulenceParameterEstimation.jl/blob/c6b7a7e47f0deaf3e3ed854ecb2665102c08ff67/src/EnsembleKalmanInversions.jl#L51-L92">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="OceanTurbulenceParameterEstimation.EnsembleKalmanInversions.IterationSummary" href="#OceanTurbulenceParameterEstimation.EnsembleKalmanInversions.IterationSummary"><code>OceanTurbulenceParameterEstimation.EnsembleKalmanInversions.IterationSummary</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">struct IterationSummary{P, M, C, V, E}</code></pre><p>Container with information about each iteration of the Ensemble Kalman Process.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/OceanTurbulenceParameterEstimation.jl/blob/c6b7a7e47f0deaf3e3ed854ecb2665102c08ff67/src/EnsembleKalmanInversions.jl#L154-L158">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="OceanTurbulenceParameterEstimation.EnsembleKalmanInversions.IterationSummary" href="#OceanTurbulenceParameterEstimation.EnsembleKalmanInversions.IterationSummary"><code>OceanTurbulenceParameterEstimation.EnsembleKalmanInversions.IterationSummary</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">IterationSummary(eki, parameters, forward_map_output=nothing)</code></pre><p>Return the summary for ensemble Kalman inversion <code>eki</code> with free <code>parameters</code> and <code>forward_map_output</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/OceanTurbulenceParameterEstimation.jl/blob/c6b7a7e47f0deaf3e3ed854ecb2665102c08ff67/src/EnsembleKalmanInversions.jl#L168-L173">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="OceanTurbulenceParameterEstimation.EnsembleKalmanInversions.column_has_nan-Tuple{Any}" href="#OceanTurbulenceParameterEstimation.EnsembleKalmanInversions.column_has_nan-Tuple{Any}"><code>OceanTurbulenceParameterEstimation.EnsembleKalmanInversions.column_has_nan</code></a> — <span class="docstring-category">Method</span></header><section><div><p>Return a BitVector indicating which particles are NaN.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/OceanTurbulenceParameterEstimation.jl/blob/c6b7a7e47f0deaf3e3ed854ecb2665102c08ff67/src/EnsembleKalmanInversions.jl#L359">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="OceanTurbulenceParameterEstimation.EnsembleKalmanInversions.iterate!-Tuple{EnsembleKalmanInversion}" href="#OceanTurbulenceParameterEstimation.EnsembleKalmanInversions.iterate!-Tuple{EnsembleKalmanInversion}"><code>OceanTurbulenceParameterEstimation.EnsembleKalmanInversions.iterate!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">iterate!(eki::EnsembleKalmanInversion; iterations = 1, show_progress = true)</code></pre><p>Iterate the ensemble Kalman inversion problem <code>eki</code> forward by <code>iterations</code>.</p><p><strong>Return</strong></p><ul><li><code>best_parameters</code>: the ensemble mean of all parameter values after the last iteration.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/OceanTurbulenceParameterEstimation.jl/blob/c6b7a7e47f0deaf3e3ed854ecb2665102c08ff67/src/EnsembleKalmanInversions.jl#L293-L302">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="OceanTurbulenceParameterEstimation.EnsembleKalmanInversions.resample!-Tuple{Resampler, Any, Any, Any}" href="#OceanTurbulenceParameterEstimation.EnsembleKalmanInversions.resample!-Tuple{Resampler, Any, Any, Any}"><code>OceanTurbulenceParameterEstimation.EnsembleKalmanInversions.resample!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">resample!(resampler::Resampler, θ, G, eki)</code></pre><p>Resamples the parameters <code>θ</code> of the <code>eki</code> process based on the number of <code>NaN</code> values inside the forward map output <code>G</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/OceanTurbulenceParameterEstimation.jl/blob/c6b7a7e47f0deaf3e3ed854ecb2665102c08ff67/src/EnsembleKalmanInversions.jl#L368-L373">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="OceanTurbulenceParameterEstimation.EnsembleKalmanInversions.sample-NTuple{4, Any}" href="#OceanTurbulenceParameterEstimation.EnsembleKalmanInversions.sample-NTuple{4, Any}"><code>OceanTurbulenceParameterEstimation.EnsembleKalmanInversions.sample</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">sample(eki, θ, G, Nsample)</code></pre><p>Generate <code>Nsample</code> new particles sampled from a multivariate Normal distribution parameterized  by the ensemble mean and covariance computed based on the <code>Nθ</code> × <code>Nensemble</code> ensemble  array <code>θ</code>, under the condition that all <code>Nsample</code> particles produce successful forward map outputs (don&#39;t include <code>NaNs</code>).</p><p><code>G</code> (<code>size(G) =  Noutput × Nensemble</code>) is the forward map output produced by <code>θ</code>.</p><p>Returns <code>Nθ × Nsample</code> parameter <code>Array</code> and <code>Noutput × Nsample</code> forward map output <code>Array</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/OceanTurbulenceParameterEstimation.jl/blob/c6b7a7e47f0deaf3e3ed854ecb2665102c08ff67/src/EnsembleKalmanInversions.jl#L244-L255">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../public/">« Public</a><a class="docs-footer-nextpage" href="../function_index/">Function index »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.12 on <span class="colophon-date" title="Tuesday 8 February 2022 01:30">Tuesday 8 February 2022</span>. Using Julia version 1.6.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
